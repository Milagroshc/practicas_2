<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- Tell the browser to be responsive to screen width -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<!-- Favicon icon -->
	<link rel="icon" type="image/png" sizes="16x16" href="../assets/images/favicon.png">
	<title>{{title}}</title>

	<!--alerts CSS -->
	<link href="{{base_url()}}/negocio/assets/node_modules/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet">
	<!-- page css -->
	<link href="{{base_url()}}/negocio/colors/dist/css/pages/login-register-lock.css" rel="stylesheet">
	<!-- Custom CSS -->
	<link href="{{base_url()}}/negocio/colors/dist/css/style.css" rel="stylesheet">


	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	<script>
		var DOMAINSITE = '{{constantes.DOMAINSITE}}';
	</script>
</head>

<body class="skin-default card-no-border">
	<!-- ============================================================== -->
	<!-- Preloader - style you can find in spinners.css -->
	<!-- ============================================================== -->
	<div class="preloader">
		<div class="loader">
			<div class="loader__figure"></div>
			<p class="loader__label">Elite admin</p>
		</div>
	</div>
	<!-- ============================================================== -->
	<!-- Main wrapper - style you can find in pages.scss -->
	<!-- ============================================================== -->
	<section id="wrapper">
		<div class="login-register"
			style="background-image:url({{base_url()}}/negocio/assets/images/background/login-register.jpg);">
			<div class="login-box card">
				<div class="card-body">
					<form novalidate class="needs-validation" id="registrar" action="#">
						<h3 class="text-center m-b-20">Crear una cuenta</h3>

						<div class="form-row">
							<div class="col-md-6 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipApellidoPaterno">TD</span>
									</div>
									<select id="TIPODOCUMENTO" name="TIPODOCUMENTO" class="custom-select" required="">
										<option value="">Tipo de documento</option>
										{% for tipoDocumento in tipoDocumentos["data"]["tabtablas"] %}
										<option value="{{ tipoDocumento.IDTABLA }}">{{ tipoDocumento.NOMBRE }}</option>
										{% endfor %}
									</select>
									<div class="invalid-tooltip">
										Seleccione el tipo de documento
									</div>
								</div>
							</div>
							<div class="col-md-6 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipNroDocumento">#</span>
									</div>
									<input type="number" class="form-control valida-tipo-doc" id="NRODOCUMENTO"
										name="NRODOCUMENTO" placeholder="Nro. documento"
										aria-describedby="validarTooltipNroDocumento" required="">
									<div class="invalid-tooltip">
										Ingresa el número de documento
									</div>
								</div>
							</div>
						</div>

						<div class="form-row">
							<div class="col-md-6">
								<div class="form-group">
									<div class="custom-control custom-radio">
										<input type="radio" id="TIPO_PERSONA_NATURAL" name="TIPO_PERSONA"
											class="custom-control-input tipo-persona" value="{{constantes.TIPO_PERSONA_JURIDICA}}">
										<label class="custom-control-label" for="TIPO_PERSONA_NATURAL">Persona
											Natural</label>
									</div>
								</div>
							</div>



							<div class="col-md-6">
								<div class="form-group">
									<div class="custom-control custom-radio">
										<input type="radio" id="TIPO_PERSONA_JURIDICA" name="TIPO_PERSONA"
											class="custom-control-input tipo-persona" value="{{constantes.TIPO_PERSONA_JURIDICA}}">
										<label class="custom-control-label" for="TIPO_PERSONA_JURIDICA">Persona
											Jurídica</label>
									</div>
								</div>
							</div>
						</div>

						<div class="form-row">

							<div class="col-md-12 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipNombre">N</span>
									</div>
									<input type="text" class="form-control valida-dni" id="NOMBRES" name="NOMBRES"
										placeholder="Nombre completo" aria-describedby="validarTooltipNombre"
										required="">
									<div class="invalid-tooltip persona-nombre">
										Ingresa el nombre completo
									</div>
								</div>
							</div>


						</div>

						<div class="form-row persona-natural">
							<div class="col-md-6 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipApellidoPaterno">AP</span>
									</div>
									<input type="text" class="form-control valida-dni persona-natural-a" id="APELLIDO_PATERNO"
										name="APELLIDO_PATERNO" placeholder="Apellido paterno"
										aria-describedby="validarTooltipApellidoPaterno" required="">
									<div class="invalid-tooltip">
										Ingresa el apellido paterno
									</div>
								</div>
							</div>
							<div class="col-md-6 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipApellidoMaterno">AM</span>
									</div>
									<input type="text" class="form-control valida-dni persona-natural-a" id="APELLIDO_MATERNO"
										name="APELLIDO_MATERNO" placeholder="Apellido materno"
										aria-describedby="validarTooltipApellidoMaterno" required="">
									<div class="invalid-tooltip">
										Ingresa el apellido materno
									</div>
								</div>
							</div>
						</div>



						<div class="form-row">
							<div class="col-md-6 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipUsuario">@</span>
									</div>
									<input type="email" class="form-control valida-dni" id="USUARIO" name="USUARIO"
										placeholder="Usuario" aria-describedby="validarTooltipUsuario" required="">
									<div class="invalid-tooltip">
										Ingrese un usuario valido (correo)
									</div>
								</div>
							</div>
							<div class="col-md-6 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipUsuario">C</span>
									</div>
									<input type="password" class="form-control valida-usuario" id="CLAVE" name="CLAVE"
										placeholder="Clave" aria-describedby="validarTooltipClave" required="">
									<div class="invalid-tooltip">
										Ingresa la clave
									</div>
								</div>
							</div>
						</div>

						<div class="form-row">

							<div class="col-md-6 mb-3">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text" id="validarTooltipConfirmarClave">CC</span>
									</div>
									<input type="password" class="form-control valida-usuario" id="CONFIRMAR_CLAVE"
										name="CONFIRMAR_CLAVE" placeholder="Confirmar clave"
										aria-describedby="validarTooltipConfirmarClave" required="">
									<div class="invalid-tooltip">
										Confirma la clave
									</div>
								</div>
							</div>

							<div class="col-md-6 mb-3">
								<div class="form-group row">
									<div class="custom-control custom-checkbox p-l-35">
										<input type="checkbox" class="custom-control-input valida-usuario"
											id="customCheck1">
										<label class="custom-control-label" for="customCheck1">Acepto todas los
											<a href="javascript:void(0)">Términos</a>
										</label>
									</div>
								</div>
							</div>
						</div>
						<div class="form-group text-center p-b-20">
							<div class="col-xs-12">
								<button
									class="btn btn-info btn-lg btn-block btn-rounded text-uppercase waves-effect waves-light submit"
									type="submit" data-action='submit'>Crear usuario</button>
							</div>
						</div>
						<div class="form-group m-b-0">
							<div class="col-sm-12 text-center">
								¿Ya tienes una cuenta?
								<a href="{{base_url()}}/ingresar" class="text-info m-l-5">
									<b>Iniciar Sesión</b>
								</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</section>
	<!-- ============================================================== -->
	<!-- End Wrapper -->
	<!-- ============================================================== -->
	<!-- ============================================================== -->
	<!-- All Jquery -->
	<!-- ============================================================== -->
	<script src="{{base_url()}}/negocio/assets/node_modules/jquery/jquery-3.2.1.min.js"> </script>
	<!-- Bootstrap tether Core JavaScript -->
	<script src="{{base_url()}}/negocio/assets/node_modules/popper/popper.min.js"></script>
	<script src="{{base_url()}}/negocio/assets/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>


	<!-- slimscrollbar scrollbar JavaScript -->
	<script src="{{base_url()}}/negocio/colors/dist/js/perfect-scrollbar.jquery.min.js"></script>
	<!--Wave Effects -->
	<script src="{{base_url()}}/negocio/colors/dist/js/waves.js"></script>
	<!--Menu sidebar -->
	<script src="{{base_url()}}/negocio/colors/dist/js/sidebarmenu.js"></script>
	<!--stickey kit -->
	<script src="{{base_url()}}/negocio/assets/node_modules/sticky-kit-master/dist/sticky-kit.min.js"></script>
	<script src="{{base_url()}}/negocio/assets/node_modules/sparkline/jquery.sparkline.min.js"></script>
	<!--Custom JavaScript -->
	<script src="{{base_url()}}/negocio/colors/dist/js/custom.min.js"></script>

	<!-- Sweet-Alert  -->
	<script src="{{base_url()}}/negocio/assets/node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>


	<script>
		// Example starter JavaScript for disabling form submissions if there are invalid fields
		(function () {
			'use strict';


			window.addEventListener('load', function () { // Fetch all the forms we want to apply custom Bootstrap validation styles to
				var forms = document.getElementsByClassName('needs-validation');
				// Loop over them and prevent submission
				var validation = Array.prototype.filter.call(forms, function (form) {
					form.addEventListener('submit', function (event) {

						if (form.checkValidity() === false) {
							event.preventDefault();
							event.stopPropagation();
							// no es valido
						} else {
							event.preventDefault();
							var param = $("#registrar").serialize();
							alert(param);
							$.ajax({
								//url: '{{base_url()}}/ajax/registrar',
								url: DOMAINSITE + 'usuario/usuarios/usuarios/nuevo-usuario-ajax',
								type: 'post',
								data: param,
								beforeSend: function (e) { // $('#load').addClass('load');
									$(".preloader").fadeIn();
								},
								success: function (data) { // alert("llego aqui ajax");
									if (data.success) {
										// $('#mensaje_acceso div').remove();
										// getRoles(data.idusuario);
										// INGRESA AL SISTEMA
										$(".alert").fadeOut();
										$(".preloader").fadeOut();
										// debe enviar un token el ajax e ingresar con este token en el dash
										window.location = '/dashboard';
									} else {
										$(".preloader").fadeOut();
										$(".alert").removeClass("alert-warning alert-danger");
										$(".alert").addClass(data.clase);
										$(".alert p").html(data.mensaje);
										$(".alert").fadeIn();
									}

									// return false;
								},
								error: function () { // $('#load').removeClass('load');
									$(".preloader").fadeOut();
								}
							});
						}
						form.classList.add('was-validated');
					}, false);
				});
			}, false);
		})();
	</script>

	<script type="text/javascript">
		$(function () {
			$(".preloader").fadeOut();
		});
		$(function () {
			//ejecutandose jquery
			$('[data-toggle="tooltip"]').tooltip();
			// desabilitar inputs
			$(".valida-dni").prop("disabled", true);
			$(".valida-usuario").prop("disabled", true);
			$(".valida-tipo-doc").prop("disabled", true);
			$(".submit").prop("disabled", true);

			//valida-dni
			$('#TIPODOCUMENTO').on('change', function () {
				$("#NRODOCUENTO").val("");
				if ($(this).val() === '') {
					$(".valida-tipo-doc").prop("disabled", true);
					$(".tipo-persona").prop('checked', false);
				} else {
					$(".valida-tipo-doc").prop("disabled", false);
					if($(this).val() != 23){
						$("#TIPO_PERSONA_NATURAL").prop("checked", true);
					}else{
						$(".tipo-persona").prop('checked', false);
					}
				}
			});
			//validando persona juridica
			$('#TIPO_PERSONA_JURIDICA').on('change', function () {
				$(".persona-nombre").html("Razón Social:");
				$(".persona-natural").hide();
				$(".persona-natural-a").prop('disabled', true);
			});
			$('#TIPO_PERSONA_NATURAL').on('change', function () {
				$(".persona-nombre").html("Nombre completo");
				$(".persona-natural").show();
				$(".persona-natural-a").prop('disabled', false);
			});



			//validar dni
			$("#NRODOCUENTO").focusout(function () {
				//direccion valida http://sentinel.trabajo.ed/pedidos/usuarios/persona/valida-persona-ajax

				var url = DOMAINSITE + 'usuario/usuarios/persona/valida-persona-ajax';
				var values = {
					TIPODOCUMENTO: $('#TIPODOCUMENTO').val(),
					NRODOCUMENTO: $(this).val()
				};
				var metodo = "POST";
				var resp = enviar(url, values, metodo);
				console.log(resp);
				if (resp.success) {
					if (!resp.persona.success) {
						//habilita los botones
						$(".valida-dni").prop("disabled", false);
						$(".persona-natural-a").prop('disabled', false);
					} else {
						$(".valida-dni").prop("disabled", true);
						Swal.fire({
							type: 'error',
							title: 'Oops...',
							text: resp.persona.mensaje
						});
					}
				} else {
					Swal.fire({
						type: 'error',
						title: 'Oops...',
						text: resp.mensaje
					});
				}
			});
			//valida si es persona juridica

			//valida si existe el usuario
			//validar dni
			$("#USUARIO").focusout(function () {
				//direccion valida http://sentinel.trabajo.ed/pedidos/usuarios/usuario/valida-usuario-ajax
				var url = DOMAINSITE + 'usuario/usuarios/usuarios/valida-usuario-ajax';
				var values = {
					USUARIO: $(this).val()
				};
				var metodo = "POST";
				var resp = enviar(url, values, metodo);
				console.log(resp);
				if (resp.success) {
					if (!resp.usuario.success) {
						//habilita los botones
						$(".valida-usuario").prop("disabled", false);
						$(".submit").prop("disabled", false);
						grecaptcha.ready(function () {
							grecaptcha.execute('6LfVqrkZAAAAACrqDnDPtfXsRiyUSz_OK4lr0r4l', { action: 'submit' }).then(function (token) {
								// Add your logic to submit to your backend server here.
							});
						});
					} else {
						$(".valida-usuario").prop("disabled", true);
						$(".submit").prop("disabled", true);
						Swal.fire({
							type: 'error',
							title: 'Oops...',
							text: resp.usuario.mensaje
						});
					}
				} else {
					Swal.fire({
						type: 'error',
						title: 'Oops...',
						text: resp.mensaje
					});
				}
			});

		// ==============================================================
		// Login and Recover Password
		// ==============================================================
		$('#to-recover').on("click", function () {
			$("#loginform").slideUp();
			$("#recoverform").fadeIn();
		});


		});


		/*FUNCION AJAX PARA REUTILIZAR*/
		function enviar(url, dato, metodo) {
			var resultado = "";
			$.ajax({
				type: metodo,
				url: url,
				async: false,
				data: dato,
				beforeSend: function (e) {
					$(".preloader").fadeIn();
				},
				success: function (data) {
					resultado = data;
					$(".preloader").fadeOut();
				},
				error: function () {
					$(".preloader").fadeOut();
				}
			});
			/*Fin ajax*/
			return resultado;
		}
	</script>
</body>
</html>